<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í™ˆ</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
    <div class="container">
      <div class="card">
        <h2>í™˜ì˜í•©ë‹ˆë‹¤ ğŸ‘‹</h2>
        <p id="welcomeMessage"></p>
        <button onclick="confirmLogout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
        <button onclick="confirmDelete()">ğŸ—‘ï¸ íšŒì› íƒˆí‡´</button>
        <button onclick="toggleDarkMode()">ğŸŒ™ ë‹¤í¬ëª¨ë“œ ì „í™˜</button>
        <!-- í”¼ë¼ë¯¸ë“œ ì´ë™ ë²„íŠ¼ -->
        <button onclick="goToPyramid()">ğŸ”º í•¨ìˆ˜í˜• í”¼ë¼ë¯¸ë“œ</button>
        <button onclick="goToPyramidClass()">ğŸ—ï¸ í´ë˜ìŠ¤í˜• í”¼ë¼ë¯¸ë“œ</button>

        

      </div>
    </div>
  
    <!-- confirm ëª¨ë‹¬ ì¬í™œìš© -->
    <div id="confirmModal" style="display: none;">
      <div class="alertBox">
        <p id="confirmText">ì •ë§ ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
        <div class="buttonGroup">
          <button id="confirmYes">í™•ì¸</button>
          <button id="confirmNo">ì·¨ì†Œ</button>
        </div>
      </div>
    </div>
  
    <script>
      function getCookie(name) { //ì¿ í‚¤ ì½ëŠ” í•¨ìˆ˜ ì¶”ê°€
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
}
      const user = getCookie("user"); // ì¿ í‚¤ì—ì„œ IDë¥¼ ê°€ì ¸ì˜´
      const welcome = document.getElementById("welcomeMessage");
  
      if (!user) {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        window.location.href = "login.html";
      } else {
        welcome.innerText = `${user}ë‹˜, ë°˜ê°€ì›Œìš”!`;
      }
  
      // ë¡œê·¸ì•„ì›ƒ
      function confirmLogout() {
        document.getElementById("confirmText").innerText = "ì •ë§ ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?";
        showConfirm(() => { //ë¡œê·¸ì•„ì›ƒ ì‹œ ì¿ í‚¤ ì‚­ì œë„ ë³€ê²½
          document.cookie = "user=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        
          window.location.href = "login.html";
        });
      }
  
      // íšŒì› íƒˆí‡´
      function confirmDelete() {
  document.getElementById("confirmText").innerText = "ì •ë§ íšŒì› íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?";
  showConfirm(() => {
    fetch("http://localhost:3000/delete-account", {
      method: "DELETE",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ ID: user })
    })
      .then(res => res.json())
      .then(data => {
        if (data.message === "íšŒì› íƒˆí‡´ ì™„ë£Œ") {
          sessionStorage.removeItem("loggedInUser");
          showAlert("íšŒì› íƒˆí‡´ ì™„ë£Œ!", "login.html");
        } else {
          showAlert(data.message);
        }
      })
      .catch(err => {
        console.error("íƒˆí‡´ ìš”ì²­ ì¤‘ ì˜¤ë¥˜:", err);
        showAlert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      });
  });
}

  
      // ë‹¤í¬ëª¨ë“œ í† ê¸€
      function toggleDarkMode() {
        document.body.classList.toggle("dark");
        localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
      }
  
      // í˜ì´ì§€ ë¡œë“œ ì‹œ ë‹¤í¬ëª¨ë“œ ìœ ì§€
      window.onload = function () {
        const theme = localStorage.getItem("theme");
        if (theme === "dark") {
          document.body.classList.add("dark");
        }
      }
  
      // ê³µí†µ í™•ì¸ì°½ ì²˜ë¦¬
      function showConfirm(callback) {
        document.getElementById("confirmModal").style.display = "flex";
        document.getElementById("confirmYes").onclick = () => {
          document.getElementById("confirmModal").style.display = "none";
          callback();
        };
        document.getElementById("confirmNo").onclick = () => {
          document.getElementById("confirmModal").style.display = "none";
        };
      }

      function goToPyramid() {
        window.location.href = "pyramid.html";
    }

      function goToPyramidClass() {
        window.location.href = "pyramid_object.html";
      }

    </script>

  <script>
    function showAlert(message, redirectUrl = null, onClose = null) {
  const alertBox = document.querySelector("#customAlert .alertBox");

  document.getElementById("alertMessage").innerText = message;
  document.getElementById("customAlert").style.display = "flex";

  // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ë¥¼ ë‹¤ì‹œ ì ìš©
  alertBox.classList.remove("fade-in");
  void alertBox.offsetWidth;
  alertBox.classList.add("fade-in");

  const confirmButton = document.querySelector("#customAlert button");
  confirmButton.onclick = function () {
    document.getElementById("customAlert").style.display = "none";

    if (redirectUrl) {
      window.location.href = redirectUrl;
    } else if (onClose) {
      onClose();  // ì½œë°± ì‹¤í–‰
    }
  };
}
    </script>

    <!-- âœ… ì»¤ìŠ¤í…€ ì•Œë¦¼ì°½ -->
<div id="customAlert" style="display: none;">
  <div class="alertBox">
    <p id="alertMessage">ì•Œë¦¼ ë©”ì‹œì§€</p>
    <button>í™•ì¸</button>
  </div>
</div>

  </body>
  
</html>
